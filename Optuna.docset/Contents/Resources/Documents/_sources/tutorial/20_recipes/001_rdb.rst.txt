
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "tutorial/20_recipes/001_rdb.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_tutorial_20_recipes_001_rdb.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_tutorial_20_recipes_001_rdb.py:


.. _rdb:

Saving/Resuming Study with RDB Backend
==========================================

An RDB backend enables persistent experiments (i.e., to save and resume a study) as well as access to history of studies.
In addition, we can run multi-node optimization tasks with this feature, which is described in :ref:`distributed`.

In this section, let's try simple examples running on a local environment with SQLite DB.

.. note::
    You can also utilize other RDB backends, e.g., PostgreSQL or MySQL, by setting the storage argument to the DB's URL.
    Please refer to `SQLAlchemy's document <https://docs.sqlalchemy.org/en/latest/core/engines.html#database-urls>`__ for how to set up the URL.


New Study
---------

We can create a persistent study by calling :func:`~optuna.study.create_study` function as follows.
An SQLite file ``example.db`` is automatically initialized with a new study record.

.. GENERATED FROM PYTHON SOURCE LINES 23-35

.. code-block:: Python


    import logging
    import sys

    import optuna

    # Add stream handler of stdout to show the messages
    optuna.logging.get_logger("optuna").addHandler(logging.StreamHandler(sys.stdout))
    study_name = "example-study"  # Unique identifier of the study.
    storage_name = "sqlite:///{}.db".format(study_name)
    study = optuna.create_study(study_name=study_name, storage=storage_name)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    A new study created in RDB with name: example-study




.. GENERATED FROM PYTHON SOURCE LINES 36-37

To run a study, call :func:`~optuna.study.Study.optimize` method passing an objective function.

.. GENERATED FROM PYTHON SOURCE LINES 37-46

.. code-block:: Python



    def objective(trial):
        x = trial.suggest_float("x", -10, 10)
        return (x - 2) ** 2


    study.optimize(objective, n_trials=3)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Trial 0 finished with value: 126.1167597941929 and parameters: {'x': -9.230171850608205}. Best is trial 0 with value: 126.1167597941929.
    Trial 1 finished with value: 6.1955629858597145 and parameters: {'x': -0.4890887862548645}. Best is trial 1 with value: 6.1955629858597145.
    Trial 2 finished with value: 28.093017725311896 and parameters: {'x': 7.300284683421438}. Best is trial 1 with value: 6.1955629858597145.




.. GENERATED FROM PYTHON SOURCE LINES 47-52

Resume Study
------------

To resume a study, instantiate a :class:`~optuna.study.Study` object
passing the study name ``example-study`` and the DB URL ``sqlite:///example-study.db``.

.. GENERATED FROM PYTHON SOURCE LINES 52-57

.. code-block:: Python



    study = optuna.create_study(study_name=study_name, storage=storage_name, load_if_exists=True)
    study.optimize(objective, n_trials=3)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Using an existing study with name 'example-study' instead of creating a new one.
    Trial 3 finished with value: 129.46406193011993 and parameters: {'x': -9.378227539037876}. Best is trial 1 with value: 6.1955629858597145.
    Trial 4 finished with value: 128.2977933093293 and parameters: {'x': -9.326861582509487}. Best is trial 1 with value: 6.1955629858597145.
    Trial 5 finished with value: 18.704532069497418 and parameters: {'x': -2.3248736478072303}. Best is trial 1 with value: 6.1955629858597145.




.. GENERATED FROM PYTHON SOURCE LINES 58-75

Note that the storage doesn't store the state of the instance of :mod:`~optuna.samplers`
and :mod:`~optuna.pruners`.
When we resume a study with a sampler whose ``seed`` argument is specified for
reproducibility, you need to restore the sampler with using ``pickle`` as follows::

    import pickle

    # Save the sampler with pickle to be loaded later.
    with open("sampler.pkl", "wb") as fout:
        pickle.dump(study.sampler, fout)

    restored_sampler = pickle.load(open("sampler.pkl", "rb"))
    study = optuna.create_study(
        study_name=study_name, storage=storage_name, load_if_exists=True, sampler=restored_sampler
    )
    study.optimize(objective, n_trials=3)


.. GENERATED FROM PYTHON SOURCE LINES 77-88

Experimental History
--------------------

Note that this section requires the installation of `Pandas <https://pandas.pydata.org/>`__:

.. code-block:: bash

    $ pip install pandas

We can access histories of studies and trials via the :class:`~optuna.study.Study` class.
For example, we can get all trials of ``example-study`` as:

.. GENERATED FROM PYTHON SOURCE LINES 88-92

.. code-block:: Python


    study = optuna.create_study(study_name=study_name, storage=storage_name, load_if_exists=True)
    df = study.trials_dataframe(attrs=("number", "value", "params", "state"))





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Using an existing study with name 'example-study' instead of creating a new one.




.. GENERATED FROM PYTHON SOURCE LINES 93-94

The method :func:`~optuna.study.Study.trials_dataframe` returns a pandas dataframe like:

.. GENERATED FROM PYTHON SOURCE LINES 94-97

.. code-block:: Python


    print(df)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

       number       value  params_x     state
    0       0  126.116760 -9.230172  COMPLETE
    1       1    6.195563 -0.489089  COMPLETE
    2       2   28.093018  7.300285  COMPLETE
    3       3  129.464062 -9.378228  COMPLETE
    4       4  128.297793 -9.326862  COMPLETE
    5       5   18.704532 -2.324874  COMPLETE




.. GENERATED FROM PYTHON SOURCE LINES 98-101

A :class:`~optuna.study.Study` object also provides properties
such as :attr:`~optuna.study.Study.trials`, :attr:`~optuna.study.Study.best_value`,
:attr:`~optuna.study.Study.best_params` (see also :ref:`first`).

.. GENERATED FROM PYTHON SOURCE LINES 101-107

.. code-block:: Python



    print("Best params: ", study.best_params)
    print("Best value: ", study.best_value)
    print("Best Trial: ", study.best_trial)
    print("Trials: ", study.trials)




.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Best params:  {'x': -0.4890887862548645}
    Best value:  6.1955629858597145
    Best Trial:  FrozenTrial(number=1, state=TrialState.COMPLETE, values=[6.1955629858597145], datetime_start=datetime.datetime(2025, 4, 12, 6, 2, 4, 471233), datetime_complete=datetime.datetime(2025, 4, 12, 6, 2, 4, 486210), params={'x': -0.4890887862548645}, user_attrs={}, system_attrs={}, intermediate_values={}, distributions={'x': FloatDistribution(high=10.0, log=False, low=-10.0, step=None)}, trial_id=2, value=None)
    Trials:  [FrozenTrial(number=0, state=TrialState.COMPLETE, values=[126.1167597941929], datetime_start=datetime.datetime(2025, 4, 12, 6, 2, 4, 424544), datetime_complete=datetime.datetime(2025, 4, 12, 6, 2, 4, 452562), params={'x': -9.230171850608205}, user_attrs={}, system_attrs={}, intermediate_values={}, distributions={'x': FloatDistribution(high=10.0, log=False, low=-10.0, step=None)}, trial_id=1, value=None), FrozenTrial(number=1, state=TrialState.COMPLETE, values=[6.1955629858597145], datetime_start=datetime.datetime(2025, 4, 12, 6, 2, 4, 471233), datetime_complete=datetime.datetime(2025, 4, 12, 6, 2, 4, 486210), params={'x': -0.4890887862548645}, user_attrs={}, system_attrs={}, intermediate_values={}, distributions={'x': FloatDistribution(high=10.0, log=False, low=-10.0, step=None)}, trial_id=2, value=None), FrozenTrial(number=2, state=TrialState.COMPLETE, values=[28.093017725311896], datetime_start=datetime.datetime(2025, 4, 12, 6, 2, 4, 499594), datetime_complete=datetime.datetime(2025, 4, 12, 6, 2, 4, 513679), params={'x': 7.300284683421438}, user_attrs={}, system_attrs={}, intermediate_values={}, distributions={'x': FloatDistribution(high=10.0, log=False, low=-10.0, step=None)}, trial_id=3, value=None), FrozenTrial(number=3, state=TrialState.COMPLETE, values=[129.46406193011993], datetime_start=datetime.datetime(2025, 4, 12, 6, 2, 4, 561869), datetime_complete=datetime.datetime(2025, 4, 12, 6, 2, 4, 585008), params={'x': -9.378227539037876}, user_attrs={}, system_attrs={}, intermediate_values={}, distributions={'x': FloatDistribution(high=10.0, log=False, low=-10.0, step=None)}, trial_id=4, value=None), FrozenTrial(number=4, state=TrialState.COMPLETE, values=[128.2977933093293], datetime_start=datetime.datetime(2025, 4, 12, 6, 2, 4, 600835), datetime_complete=datetime.datetime(2025, 4, 12, 6, 2, 4, 615392), params={'x': -9.326861582509487}, user_attrs={}, system_attrs={}, intermediate_values={}, distributions={'x': FloatDistribution(high=10.0, log=False, low=-10.0, step=None)}, trial_id=5, value=None), FrozenTrial(number=5, state=TrialState.COMPLETE, values=[18.704532069497418], datetime_start=datetime.datetime(2025, 4, 12, 6, 2, 4, 628458), datetime_complete=datetime.datetime(2025, 4, 12, 6, 2, 4, 643229), params={'x': -2.3248736478072303}, user_attrs={}, system_attrs={}, intermediate_values={}, distributions={'x': FloatDistribution(high=10.0, log=False, low=-10.0, step=None)}, trial_id=6, value=None)]





.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.795 seconds)


.. _sphx_glr_download_tutorial_20_recipes_001_rdb.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: 001_rdb.ipynb <001_rdb.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: 001_rdb.py <001_rdb.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: 001_rdb.zip <001_rdb.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
